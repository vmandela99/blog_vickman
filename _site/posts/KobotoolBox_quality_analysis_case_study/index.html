<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Victor Mandela">
<meta name="dcterms.date" content="2024-10-16">

<title>Data Quality, Analysis, and Case Studies Using KoboToolbox</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=GTM-T8DDSMN"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'GTM-T8DDSMN', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../custom.scss">
<meta property="og:title" content="Data Quality, Analysis, and Case Studies Using KoboToolbox">
<meta property="og:description" content="">
<meta property="og:image" content="kobotoolbox.PNG">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-my-courses" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">My Courses</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-my-courses">    
        <li>
    <a class="dropdown-item" href="../../courses/python.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../courses/ruby.html">
 <span class="dropdown-text">Ruby</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../courses/SQL.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../Projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Skills.html"> 
<span class="menu-text">Skills</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Templates and Resources.html"> 
<span class="menu-text">Templates and Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Case Study.html"> 
<span class="menu-text">Case Study</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About Vickman</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contact/index.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/vmandela99"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/vmandela99/" target="_blank"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:vmandela99@gmail.com"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="http://x.com/VictorMandela8"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/vmandela99"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.nature.com/articles/s41598-025-89030-z"> <i class="bi bi-briefcase" role="img">
</i> 
<span class="menu-text">Google Scholar</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Data Quality, Analysis, and Case Studies Using KoboToolbox</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Survey</div>
                <div class="quarto-category">Data Collection</div>
                <div class="quarto-category">KoboToolbox</div>
                <div class="quarto-category">CAPI</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Victor Mandela </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 16, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="automating-quality-checks-in-capi-using-kobotoolbox-features" class="level4">
<h4 class="anchored" data-anchor-id="automating-quality-checks-in-capi-using-kobotoolbox-features"><strong>Automating Quality Checks in CAPI Using KoboToolbox Features</strong></h4>
<p>One of the best features of KoboToolbox is its ability to automate quality checks during data collection. This ensures that the data you collect is clean and ready for analysis, reducing the need for time-consuming manual corrections later.</p>
<p>Here’s how you can improve data quality with KoboToolbox:</p>
<ol type="1">
<li><p><strong>Use Validation Criteria</strong><br>
KoboToolbox allows you to set validation rules for questions, ensuring that respondents enter data in the correct format. For example, if you’re collecting age data, you can set a rule that the age must be between 0 and 120. This prevents errors like entering “500” as an age.</p>
<p><strong>Example</strong>: If your survey asks, “How many children do you have?” you can set a validation rule to ensure the response is a number between 0 and 15, preventing incorrect entries.</p></li>
<li><p><strong>Add Mandatory Questions</strong><br>
You can make certain questions mandatory so that respondents cannot skip them. This is particularly important for critical questions that are essential to your data analysis.</p>
<p><strong>Example</strong>: In a health survey, you can make the question “What is your gender?” mandatory, ensuring that no response is left out during the interview.</p></li>
<li><p><strong>Use Constraints for Logical Responses</strong><br>
You can set constraints to make sure answers are logical. For instance, if someone answers that they are 5 years old, a constraint can prevent them from answering that they have children, as this would be an illogical response.</p>
<p><strong>Example</strong>: If a respondent selects “No” to the question “Do you own a mobile phone?”, you can add a constraint that prevents them from answering follow-up questions about phone usage, improving the survey’s flow.</p></li>
<li><p><strong>Preview and Test Before Data Collection</strong><br>
Always preview and test your survey before deployment to ensure that the validation criteria and constraints work as expected. Testing prevents errors during actual data collection.</p>
<p><strong>Example</strong>: Before deploying a survey on school attendance, preview it by entering test responses. This will show you if the logic and constraints work, such as preventing a respondent from entering “10” when asked “How many school days did you miss last month?” if the maximum allowed is 5.</p></li>
</ol>
</section>
<section id="real-time-data-collection-and-analysis-with-kobotoolbox" class="level4">
<h4 class="anchored" data-anchor-id="real-time-data-collection-and-analysis-with-kobotoolbox"><strong>Real-Time Data Collection and Analysis with KoboToolbox</strong></h4>
<p>One of the most powerful features of KoboToolbox is the ability to collect and monitor data in real time. This gives you immediate insights into your survey results, enabling you to make adjustments on the fly and ensure data accuracy.</p>
<ol type="1">
<li><p><strong>Monitor Data as It’s Collected</strong><br>
KoboToolbox allows you to view the incoming data while your field team is still collecting it. You can see the number of responses collected, check for any missing or incomplete data, and identify potential issues early on.</p>
<p><strong>Example</strong>: If you’re conducting a survey on household income, you can monitor the data to ensure all responses are complete. If you notice that a certain region is submitting fewer responses, you can contact your field team to address the issue before it becomes a bigger problem.</p></li>
<li><p><strong>Export Data for Analysis</strong><br>
Once the data is collected, you can export it to a variety of formats such as Excel, CSV, or even directly into statistical software like R or SPSS for deeper analysis. This allows you to clean and analyze the data as soon as it’s uploaded.</p>
<p><strong>Example</strong>: After completing a survey on water usage in rural areas, you can export the data to Excel, where you can filter responses and run simple analyses, such as calculating the average water consumption per household.</p></li>
<li><p><strong>Visualize Data Quickly</strong><br>
KoboToolbox includes basic data visualization tools, allowing you to create simple graphs or charts directly on the platform. This is useful for quick insights without having to use other software.</p>
<p><strong>Example</strong>: If you’re collecting data on the types of crops grown in different regions, KoboToolbox lets you generate pie charts to see the proportion of households growing maize, beans, or other crops at a glance.</p></li>
</ol>
</section>
<section id="how-to-visualize-capi-data-collected-via-kobotoolbox" class="level4">
<h4 class="anchored" data-anchor-id="how-to-visualize-capi-data-collected-via-kobotoolbox"><strong>How to Visualize CAPI Data Collected via KoboToolbox</strong></h4>
<p>Visualizing the data collected using KoboToolbox helps turn raw data into meaningful insights. Here’s how you can quickly create visualizations for your data:</p>
<ol type="1">
<li><p><strong>Use KoboToolbox’s Built-In Visualization</strong><br>
KoboToolbox offers simple tools to visualize your survey results as bar charts, pie charts, or frequency tables. This is ideal for getting a quick overview of your data, especially if you need a snapshot during fieldwork.</p>
<p><strong>Example</strong>: After completing a survey on school enrollment, you can quickly create a pie chart to visualize the percentage of boys and girls enrolled in school.</p></li>
<li><p><strong>Export Data for Advanced Visualization</strong><br>
If you need more complex visualizations, export the data to Excel or a data visualization tool like Tableau. From there, you can create more detailed graphs, maps, or dashboards to better understand trends or patterns in your data.</p>
<p><strong>Example</strong>: After collecting data on household energy sources, you can export the data to Tableau and create a map that shows which regions rely more on firewood versus electricity, giving you a clearer picture of energy access in different areas.</p></li>
<li><p><strong>Visualize Trends Over Time</strong><br>
If your survey involves tracking data over time, you can create trend charts to visualize changes. This is especially useful in longitudinal studies where you need to monitor progress or compare results from different survey rounds.</p>
<p><strong>Example</strong>: If you’re running a survey on child nutrition over several months, you can use KoboToolbox’s export feature to create a line chart in Excel, showing how the average weight of children has changed over time.</p></li>
</ol>
</section>
<section id="case-study-improving-health-data-collection-with-kobotoolbox-capi" class="level4">
<h4 class="anchored" data-anchor-id="case-study-improving-health-data-collection-with-kobotoolbox-capi"><strong>Case Study: Improving Health Data Collection with KoboToolbox CAPI</strong></h4>
<p>To illustrate the power of KoboToolbox, let’s look at a real-world case study of how it was used to improve health data collection in a rural setting.</p>
<p><strong>The Challenge</strong>:<br>
A health NGO was tasked with collecting data on vaccination coverage in remote villages. Previously, they used paper surveys, which often led to errors, delays, and missing data. The team needed a more efficient way to gather accurate information in areas with no internet access.</p>
<p><strong>The Solution</strong>:<br>
The team switched to using KoboToolbox for CAPI. They designed a digital survey with validation rules and skip logic to ensure that only relevant questions were asked. The team collected data offline using the KoboCollect app and synced it later when they returned to areas with internet connectivity.</p>
<p><strong>Results</strong>:</p>
<ul>
<li><p><strong>Improved Accuracy</strong>: With validation rules, errors were minimized. For example, respondents couldn’t enter invalid ages for children receiving vaccines.</p></li>
<li><p><strong>Faster Data Processing</strong>: Instead of waiting weeks for paper forms to be submitted and entered manually, data was available in real time, allowing the team to start analyzing it immediately.</p></li>
<li><p><strong>Higher Quality Data</strong>: By using mandatory fields and skip logic, the survey reduced missing responses and improved the overall quality of the data.</p></li>
</ul>
<p><strong>Example</strong>: In one village, the NGO was able to quickly determine that vaccination coverage for measles was lower than expected, allowing them to take immediate action by organizing more vaccination clinics.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>